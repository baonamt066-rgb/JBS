<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>B√°n l·∫°i s·∫£n ph·∫©m</title>
  <link rel="stylesheet" href="checkout.css">
</head>
<body>
  <h1 id="page-title">üîÑ B√°n l·∫°i s·∫£n ph·∫©m</h1> <!-- JS s·∫Ω thay ƒë·ªïi n·∫øu edit -->

  <div class="resell-container">
    <!-- N√∫t quay l·∫°i -->
    <a href="products.html" class="back-btn">‚¨Ö Quay l·∫°i s·∫£n ph·∫©m</a>

    <!-- Hi·ªÉn th·ªã dropdown ·ªü c·∫£ hai mode (s·ª≠a: kh√¥ng ·∫©n ·ªü edit mode) -->
    <div id="product-select-section">
      <label for="my-products">Ch·ªçn s·∫£n ph·∫©m b·∫°n mu·ªën b√°n l·∫°i:</label>
      <select id="my-products">
        <option value="">-- Ch·ªçn s·∫£n ph·∫©m --</option>
      </select>
    </div>

    <!-- Form -->
    <form id="resell-form">
      <label for="resell-name">T√™n s·∫£n ph·∫©m:</label>
      <input type="text" id="resell-name" placeholder="Nh·∫≠p t√™n s·∫£n ph·∫©m" required>

      <label for="resell-img">Link ·∫£nh s·∫£n ph·∫©m:</label>
      <input type="url" id="resell-img" placeholder="D√°n link ·∫£nh" required>

      <label for="resell-desc">Chi ti·∫øt s·∫£n ph·∫©m:</label>
      <textarea id="resell-desc" placeholder="Nh·∫≠p m√¥ t·∫£ s·∫£n ph·∫©m" required></textarea>

      <label for="resell-price">Gi√° b√°n:</label>
      <input type="text" id="resell-price" placeholder="Nh·∫≠p gi√° mong mu·ªën (v√≠ d·ª•: 1000000)" required>

      <!-- Input cho Nh√† s·∫£n xu·∫•t (optional) -->
      <label for="resell-manufacturer">Nh√† s·∫£n xu·∫•t:</label>
      <input type="text" id="resell-manufacturer" placeholder="Nh·∫≠p t√™n nh√† s·∫£n xu·∫•t (t√πy ch·ªçn)">

      <button type="submit" class="resell-btn" id="submit-btn">ƒêƒÉng b√°n s·∫£n ph·∫©m</button>
    </form>
  </div>

 <script>
  document.addEventListener("DOMContentLoaded", () => {
  // S·ª± ki·ªán n√†y ch·ªù cho ƒë·∫øn khi to√†n b·ªô t√†i li·ªáu HTML ƒë∆∞·ª£c t·∫£i xong, ƒë·∫£m b·∫£o t·∫•t c·∫£ ph·∫ßn t·ª≠ DOM c√≥ th·ªÉ ƒë∆∞·ª£c truy c·∫≠p m√† kh√¥ng b·ªã l·ªói.
  
  const productSelect = document.getElementById("my-products"); // L·∫•y ph·∫ßn t·ª≠ dropdown (select) c√≥ ID "my-products" ƒë·ªÉ hi·ªÉn th·ªã danh s√°ch s·∫£n ph·∫©m.
  const resellForm = document.getElementById("resell-form"); // L·∫•y ph·∫ßn t·ª≠ form c√≥ ID "resell-form" d√πng ƒë·ªÉ nh·∫≠p th√¥ng tin s·∫£n ph·∫©m.
  const pageTitle = document.getElementById("page-title"); // L·∫•y ph·∫ßn t·ª≠ ti√™u ƒë·ªÅ trang ƒë·ªÉ c·∫≠p nh·∫≠t n·ªôi dung ƒë·ªông.
  const productSelectSection = document.getElementById("product-select-section"); // L·∫•y ph·∫ßn t·ª≠ ch·ª©a dropdown s·∫£n ph·∫©m.
  const submitBtn = document.getElementById("submit-btn"); // L·∫•y n√∫t submit form ƒë·ªÉ thay ƒë·ªïi n·ªôi dung v√† x·ª≠ l√Ω s·ª± ki·ªán.
  // C·∫≠p nh·∫≠t s·∫£n ph·∫©m
  const urlParams = new URLSearchParams(window.location.search); // T·∫°o ƒë·ªëi t∆∞·ª£ng ƒë·ªÉ ph√¢n t√≠ch tham s·ªë URL (v√≠ d·ª•: ?edit=someId).
  const editId = urlParams.get('edit'); // L·∫•y gi√° tr·ªã c·ªßa tham s·ªë 'edit' t·ª´ URL, d√πng ƒë·ªÉ x√°c ƒë·ªãnh ch·∫ø ƒë·ªô ch·ªânh s·ª≠a.
  let isEditMode = !!editId; // Chuy·ªÉn editId th√†nh boolean: true n·∫øu t·ªìn t·∫°i (ch·∫ø ƒë·ªô ch·ªânh s·ª≠a), false n·∫øu kh√¥ng.
  let currentProduct = null; // Bi·∫øn l∆∞u tr·ªØ s·∫£n ph·∫©m hi·ªán t·∫°i, ban ƒë·∫ßu l√† null.
  let currentEditId = editId; // L∆∞u ID ch·ªânh s·ª≠a t·ª´ URL ƒë·ªÉ s·ª≠ d·ª•ng trong c√°c h√†m (gi·ªØ nguy√™n ID).
  let pendingToRemove = null; // Bi·∫øn theo d√µi s·∫£n ph·∫©m pending c·∫ßn x√≥a sau khi submit, tr√°nh x√≥a s·ªõm.

  // H√†m loadDropdown: T·∫£i danh s√°ch s·∫£n ph·∫©m v√†o dropdown, v·ªõi logic l·ªçc tr√πng t√™n v√† x·ª≠ l√Ω ch·∫ø ƒë·ªô.
  function loadDropdown() {
    const resellList = JSON.parse(localStorage.getItem("resellList")) || []; // L·∫•y m·∫£ng "resellList" t·ª´ localStorage, n·∫øu kh√¥ng t·ªìn t·∫°i th√¨ d√πng m·∫£ng r·ªóng.
    const tempCart = JSON.parse(localStorage.getItem("tempCartForResell")) || []; // L·∫•y m·∫£ng "tempCartForResell" t·ª´ localStorage, n·∫øu kh√¥ng t·ªìn t·∫°i th√¨ d√πng m·∫£ng r·ªóng.
    productSelect.innerHTML = '<option value="">-- Ch·ªçn s·∫£n ph·∫©m --</option>'; // Reset n·ªôi dung dropdown v√† th√™m option m·∫∑c ƒë·ªãnh.
    
    if (!isEditMode) { // N·∫øu kh√¥ng ph·∫£i ch·∫ø ƒë·ªô ch·ªânh s·ª≠a (t·ª©c l√† ch·∫ø ƒë·ªô t·∫°o m·ªõi).
      // Ch·∫ø ƒë·ªô t·∫°o m·ªõi: Ch·ªâ th√™m s·∫£n ph·∫©m t·ª´ tempCart.
      if (tempCart.length > 0) { // Ki·ªÉm tra n·∫øu tempCart c√≥ s·∫£n ph·∫©m.
        tempCart.forEach(item => { // Duy·ªát qua t·ª´ng s·∫£n ph·∫©m trong tempCart.
          const option = document.createElement("option"); // T·∫°o m·ªôt ph·∫ßn t·ª≠ option m·ªõi.
          const pendingValue = `pending-${item.name}`; // T·∫°o gi√° tr·ªã cho option v·ªõi prefix "pending-" ƒë·ªÉ nh·∫≠n di·ªán.
          option.value = pendingValue; // ƒê·∫∑t gi√° tr·ªã c·ªßa option.
          option.text = item.name; // ƒê·∫∑t n·ªôi dung hi·ªÉn th·ªã l√† t√™n s·∫£n ph·∫©m.
          option.setAttribute('data-type', 'pending'); // Th√™m thu·ªôc t√≠nh data-type ƒë·ªÉ ph√¢n bi·ªát lo·∫°i s·∫£n ph·∫©m.
          productSelect.appendChild(option); // Th√™m option v√†o dropdown.
        });
      } else { // N·∫øu tempCart r·ªóng.
        const noProductOption = document.createElement("option"); // T·∫°o option th√¥ng b√°o.
        noProductOption.value = ""; // Kh√¥ng c√≥ gi√° tr·ªã.
        noProductOption.text = "Kh√¥ng c√≥ s·∫£n ph·∫©m n√†o ƒë·ªÉ b√°n l·∫°i"; // N·ªôi dung th√¥ng b√°o.
        noProductOption.disabled = true; // L√†m option n√†y kh√¥ng th·ªÉ ch·ªçn.
        productSelect.appendChild(noProductOption); // Th√™m v√†o dropdown.
      }
    } else { // N·∫øu l√† ch·∫ø ƒë·ªô ch·ªânh s·ª≠a.
      // Ch·∫ø ƒë·ªô ch·ªânh s·ª≠a: Th√™m s·∫£n ph·∫©m hi·ªán t·∫°i (A) v√† c√°c pending kh√¥ng tr√πng t√™n.
      const currentName = resellList.find(item => item.id === currentEditId)?.name || ''; // T√¨m t√™n s·∫£n ph·∫©m d·ª±a tr√™n currentEditId, n·∫øu kh√¥ng t√¨m th·∫•y th√¨ d√πng chu·ªói r·ªóng.
      if (currentEditId) { // N·∫øu c√≥ ID ch·ªânh s·ª≠a.
        const currentEditProduct = resellList.find(item => item.id === currentEditId); // T√¨m s·∫£n ph·∫©m trong resellList.
        if (currentEditProduct) { // N·∫øu t√¨m th·∫•y.
          const option = document.createElement("option"); // T·∫°o option m·ªõi.
          option.value = currentEditId; // ƒê·∫∑t gi√° tr·ªã l√† ID s·∫£n ph·∫©m.
          option.text = currentName; // ƒê·∫∑t n·ªôi dung l√† t√™n s·∫£n ph·∫©m.
          option.setAttribute('data-type', 'resell'); // Th√™m thu·ªôc t√≠nh data-type.
          productSelect.appendChild(option); // Th√™m option.
          productSelect.value = currentEditId; // T·ª± ƒë·ªông ch·ªçn option n√†y.
        }
      }
      
      // Th√™m s·∫£n ph·∫©m pending, nh∆∞ng ch·ªâ nh·ªØng c√°i kh√¥ng tr√πng t√™n v·ªõi s·∫£n ph·∫©m hi·ªán t·∫°i.
      if (tempCart.length > 0) {
        tempCart.forEach(item => {
          if (item.name !== currentName) { // Ki·ªÉm tra kh√¥ng tr√πng t√™n.
            const option = document.createElement("option");
            const pendingValue = `pending-${item.name}`;
            option.value = pendingValue;
            option.text = item.name;
            option.setAttribute('data-type', 'pending');
            productSelect.appendChild(option);
          }
        });
      } else if (!currentEditId) { // N·∫øu kh√¥ng c√≥ ID ch·ªânh s·ª≠a v√† tempCart r·ªóng.
        const noProductOption = document.createElement("option");
        noProductOption.value = "";
        noProductOption.text = "Kh√¥ng t√¨m th·∫•y s·∫£n ph·∫©m ƒë·ªÉ ch·ªânh s·ª≠a";
        noProductOption.disabled = true;
        productSelect.appendChild(noProductOption);
      }
    }

    productSelectSection.style.display = 'block'; // Hi·ªÉn th·ªã ph·∫ßn ch·ª©a dropdown.
  }

  // H√†m loadProductToForm: X·ª≠ l√Ω vi·ªác t·∫£i d·ªØ li·ªáu s·∫£n ph·∫©m v√†o form khi ch·ªçn t·ª´ dropdown.
  function loadProductToForm(selectedValue) {
    const resellList = JSON.parse(localStorage.getItem("resellList")) || [];
    const tempCart = JSON.parse(localStorage.getItem("tempCartForResell")) || [];

    if (selectedValue.startsWith('pending-')) {
      // X·ª≠ l√Ω khi chuy·ªÉn sang s·∫£n ph·∫©m pending (B): C·∫≠p nh·∫≠t form v√† UI.
      const pendingName = selectedValue.replace('pending-', ''); // Lo·∫°i b·ªè prefix 'pending-' ƒë·ªÉ l·∫•y t√™n s·∫£n ph·∫©m.
      currentProduct = tempCart.find(item => item.name === pendingName); // T√¨m s·∫£n ph·∫©m trong tempCart.
      if (currentProduct) {
        const newName = currentProduct.name; // L·∫•y t√™n m·ªõi.
        document.getElementById("resell-name").value = newName; // ƒêi·ªÅn t√™n v√†o field.
        
        // Reset c√°c field kh√°c ƒë·ªÉ ng∆∞·ªùi d√πng nh·∫≠p m·ªõi.
        document.getElementById("resell-img").value = '';
        document.getElementById("resell-desc").value = '';
        document.getElementById("resell-price").value = '';
        document.getElementById("resell-manufacturer").value = '';
        
        pendingToRemove = pendingName; // ƒê√°nh d·∫•u s·∫£n ph·∫©m ƒë·ªÉ x√≥a sau khi submit.
        
        // C·∫≠p nh·∫≠t UI c·ªßa dropdown: Thay ƒë·ªïi text c·ªßa option A th√†nh t√™n B.
        const currentOption = productSelect.querySelector(`option[value="${currentEditId}"]`);
        if (currentOption) {
          currentOption.text = newName; // C·∫≠p nh·∫≠t n·ªôi dung hi·ªÉn th·ªã.
        }
        
        pageTitle.innerText = '‚úè Ch·ªânh s·ª≠a s·∫£n ph·∫©m'; // C·∫≠p nh·∫≠t ti√™u ƒë·ªÅ trang.
        submitBtn.innerText = 'C·∫≠p nh·∫≠t s·∫£n ph·∫©m'; // C·∫≠p nh·∫≠t n·ªôi dung n√∫t submit.
        productSelect.value = currentEditId; // Gi·ªØ selection l√† A, nh∆∞ng v·ªõi text m·ªõi.
      }
    } else if (selectedValue === currentEditId) {
      // X·ª≠ l√Ω khi ch·ªçn l·∫°i s·∫£n ph·∫©m g·ªëc (A).
      currentProduct = resellList.find(item => item.id === selectedValue); // T√¨m s·∫£n ph·∫©m trong resellList.
      if (currentProduct) {
        document.getElementById("resell-name").value = currentProduct.name; // ƒêi·ªÅn t√™n.
        document.getElementById("resell-img").value = currentProduct.img; // ƒêi·ªÅn link ·∫£nh.
        document.getElementById("resell-desc").value = currentProduct.desc; // ƒêi·ªÅn m√¥ t·∫£.
        
        const cleanPrice = currentProduct.price.replace(/\D/g, ""); // L·∫•y gi√° v√† lo·∫°i b·ªè k√Ω t·ª± kh√¥ng ph·∫£i s·ªë (nh∆∞ "ƒë").
        const priceNum = parseInt(cleanPrice); // Chuy·ªÉn th√†nh s·ªë nguy√™n.
        if (!isNaN(priceNum) && priceNum > 0) {
          document.getElementById("resell-price").value = priceNum.toLocaleString("vi-VN"); // ƒê·ªãnh d·∫°ng gi√° theo ƒë·ªãnh d·∫°ng Vi·ªát Nam v√† ƒëi·ªÅn v√†o field.
        } else {
          document.getElementById("resell-price").value = ''; // N·∫øu gi√° kh√¥ng h·ª£p l·ªá, reset field.
        }
        
        document.getElementById("resell-manufacturer").value = currentProduct.manufacturer || ''; // ƒêi·ªÅn nh√† s·∫£n xu·∫•t, n·∫øu kh√¥ng c√≥ th√¨ ƒë·ªÉ tr·ªëng.
        
        pageTitle.innerText = '‚úè Ch·ªânh s·ª≠a s·∫£n ph·∫©m'; // C·∫≠p nh·∫≠t ti√™u ƒë·ªÅ.
        submitBtn.innerText = 'C·∫≠p nh·∫≠t s·∫£n ph·∫©m'; // C·∫≠p nh·∫≠t n√∫t submit.
        pendingToRemove = null; // Reset bi·∫øn, v√¨ quay l·∫°i s·∫£n ph·∫©m A.
      }
    }
  }

  // C·∫≠p nh·∫≠t , Load ban ƒë·∫ßu: G·ªçi h√†m ƒë·ªÉ t·∫£i dropdown v√† thi·∫øt l·∫≠p s·ª± ki·ªán.
  if (isEditMode) {
    loadDropdown(); // T·∫£i dropdown n·∫øu l√† ch·∫ø ƒë·ªô ch·ªânh s·ª≠a.
    if (currentEditId) {
      loadProductToForm(currentEditId); // T·∫£i d·ªØ li·ªáu s·∫£n ph·∫©m v√†o form n·∫øu c√≥ ID.
    }
  } else {
    loadDropdown(); // T·∫£i dropdown cho ch·∫ø ƒë·ªô t·∫°o m·ªõi.
    // Th√™m event listener cho dropdown ·ªü ch·∫ø ƒë·ªô t·∫°o m·ªõi.
    productSelect.addEventListener("change", () => {
      const selectedValue = productSelect.value;
      if (selectedValue && !isEditMode && selectedValue.startsWith('pending-')) {
        const pendingName = selectedValue.replace('pending-', ''); // L·∫•y t√™n s·∫£n ph·∫©m t·ª´ gi√° tr·ªã selected.
        document.getElementById("resell-name").value = pendingName; // Auto-fill t√™n s·∫£n ph·∫©m.
        // Reset c√°c field kh√°c.
        document.getElementById("resell-img").value = '';
        document.getElementById("resell-desc").value = '';
        document.getElementById("resell-price").value = '';
        document.getElementById("resell-manufacturer").value = '';
        pageTitle.innerText = 'üîÑ B√°n l·∫°i s·∫£n ph·∫©m'; // C·∫≠p nh·∫≠t ti√™u ƒë·ªÅ.
        submitBtn.innerText = 'ƒêƒÉng b√°n s·∫£n ph·∫©m'; // C·∫≠p nh·∫≠t n√∫t submit.
      }
    });
  }

  // Event listener cho s·ª± ki·ªán thay ƒë·ªïi dropdown.
  productSelect.addEventListener("change", (e) => {
    const selectedValue = e.target.value; // L·∫•y gi√° tr·ªã ƒë∆∞·ª£c ch·ªçn.
    if (!selectedValue) return; // N·∫øu kh√¥ng ch·ªçn g√¨, tho√°t h√†m.
    
    if (!isEditMode) return; // N·∫øu kh√¥ng ph·∫£i ch·∫ø ƒë·ªô ch·ªânh s·ª≠a, kh√¥ng x·ª≠ l√Ω ·ªü ƒë√¢y.
    
    if (selectedValue !== currentEditId) { // N·∫øu ch·ªçn gi√° tr·ªã kh√°c v·ªõi ID hi·ªán t·∫°i.
      if (confirm('B·∫°n mu·ªën chuy·ªÉn sang s·∫£n ph·∫©m kh√°c? D·ªØ li·ªáu hi·ªán t·∫°i s·∫Ω b·ªã m·∫•t n·∫øu ch∆∞a l∆∞u.')) { // H·ªèi x√°c nh·∫≠n.
        loadProductToForm(selectedValue); // G·ªçi h√†m ƒë·ªÉ load d·ªØ li·ªáu m·ªõi.
      } else {
        e.target.value = currentEditId; // Gi·ªØ nguy√™n gi√° tr·ªã hi·ªán t·∫°i.
        loadProductToForm(currentEditId); // Load l·∫°i d·ªØ li·ªáu g·ªëc.
      }
    } else {
      loadProductToForm(selectedValue); // N·∫øu ch·ªçn l·∫°i gi√° tr·ªã hi·ªán t·∫°i, load n√≥.
    }
  });

  // Event listener cho s·ª± ki·ªán submit form.
  resellForm.addEventListener("submit", (e) => {
    e.preventDefault(); // NgƒÉn ch·∫∑n h√†nh vi m·∫∑c ƒë·ªãnh c·ªßa form (t·ª©c l√† kh√¥ng reload trang).
    
    if (!isEditMode && productSelect.value === "") { // N·∫øu kh√¥ng ph·∫£i ch·∫ø ƒë·ªô ch·ªânh s·ª≠a v√† ch∆∞a ch·ªçn s·∫£n ph·∫©m.
      alert("Vui l√≤ng ch·ªçn s·∫£n ph·∫©m t·ª´ danh s√°ch ƒë·ªÉ b√°n l·∫°i!");
      return; // Tho√°t h√†m.
    }
    
    const name = document.getElementById("resell-name").value.trim(); // L·∫•y v√† trim gi√° tr·ªã t√™n s·∫£n ph·∫©m.
    const img = document.getElementById("resell-img").value.trim(); // L·∫•y v√† trim gi√° tr·ªã link ·∫£nh.
    const desc = document.getElementById("resell-desc").value.trim(); // L·∫•y v√† trim gi√° tr·ªã m√¥ t·∫£.
    const priceInput = document.getElementById("resell-price").value.trim(); // L·∫•y v√† trim gi√° tr·ªã gi√°.
    
    const cleanPriceInput = priceInput.replace(/\./g, ''); // Lo·∫°i b·ªè d·∫•u ch·∫•m (.) trong gi√° ƒë·ªÉ chu·∫©n h√≥a.
    const priceNum = parseInt(cleanPriceInput); // Chuy·ªÉn chu·ªói gi√° th√†nh s·ªë nguy√™n.
    if (isNaN(priceNum) || priceNum <= 0) { // Ki·ªÉm tra n·∫øu gi√° kh√¥ng ph·∫£i s·ªë ho·∫∑c nh·ªè h∆°n ho·∫∑c b·∫±ng 0.
      alert("Gi√° ph·∫£i l√† s·ªë l·ªõn h∆°n 0!");
      return; // Tho√°t h√†m.
    }
    
    const formattedPrice = priceNum.toLocaleString("vi-VN") + "ƒë"; // ƒê·ªãnh d·∫°ng gi√° theo ƒë·ªãnh d·∫°ng Vi·ªát Nam v√† th√™m ƒë∆°n v·ªã "ƒë".
    const manufacturer = document.getElementById("resell-manufacturer").value.trim(); // L·∫•y v√† trim gi√° tr·ªã nh√† s·∫£n xu·∫•t.
    
    if (!name || !img || !desc || !priceInput) { // Ki·ªÉm tra n·∫øu b·∫•t k·ª≥ field n√†o tr·ªëng.
      alert("Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß th√¥ng tin!");
      return; // Tho√°t h√†m.
    }
    
    let resellList = JSON.parse(localStorage.getItem("resellList")) || []; // L·∫•y m·∫£ng resellList t·ª´ localStorage.
    let tempCart = JSON.parse(localStorage.getItem("tempCartForResell")) || []; // L·∫•y m·∫£ng tempCartForResell t·ª´ localStorage.
    
    if (isEditMode && currentEditId) { // N·∫øu l√† ch·∫ø ƒë·ªô ch·ªânh s·ª≠a.
      const index = resellList.findIndex(item => item.id === currentEditId); // T√¨m index c·ªßa s·∫£n ph·∫©m c·∫ßn ch·ªânh s·ª≠a.
      if (index !== -1) { // N·∫øu t√¨m th·∫•y.
        const duplicate = resellList.find((item, i) => item.name === name && i !== index); // Ki·ªÉm tra tr√πng t√™n v·ªõi s·∫£n ph·∫©m kh√°c.
        if (duplicate) {
          alert("T√™n s·∫£n ph·∫©m tr√πng v·ªõi s·∫£n ph·∫©m kh√°c!");
          return; // Tho√°t h√†m.
        }
        resellList[index] = { ...resellList[index], name, img, desc, price: formattedPrice, manufacturer: manufacturer || '' }; // C·∫≠p nh·∫≠t s·∫£n ph·∫©m t·∫°i index.
        localStorage.setItem("resellList", JSON.stringify(resellList)); // L∆∞u l·∫°i resellList.
        
        if (pendingToRemove) { // N·∫øu c√≥ s·∫£n ph·∫©m pending c·∫ßn x√≥a.
          tempCart = tempCart.filter(item => item.name !== pendingToRemove); // L·ªçc ƒë·ªÉ x√≥a s·∫£n ph·∫©m pending.
          localStorage.setItem("tempCartForResell", JSON.stringify(tempCart.length > 0 ? tempCart : [])); // L∆∞u tempCart m·ªõi.
          if (tempCart.length === 0) {
            localStorage.removeItem("tempCartForResell"); // X√≥a key n·∫øu tempCart r·ªóng.
          }
          pendingToRemove = null; // Reset bi·∫øn.
        }
        
        alert("C·∫≠p nh·∫≠t th√†nh c√¥ng!"); // Th√¥ng b√°o th√†nh c√¥ng.
        window.location.href = "products.html"; // Chuy·ªÉn h∆∞·ªõng v·ªÅ trang products.
      } else {
        alert("L·ªói: Kh√¥ng t√¨m th·∫•y s·∫£n ph·∫©m ƒë·ªÉ c·∫≠p nh·∫≠t!"); // Th√¥ng b√°o l·ªói.
      }
      return; // K·∫øt th√∫c h√†m.
    } else { // N·∫øu l√† ch·∫ø ƒë·ªô t·∫°o m·ªõi.
      const exists = resellList.find(item => item.name === name); // Ki·ªÉm tra s·∫£n ph·∫©m ƒë√£ t·ªìn t·∫°i.
      if (exists) {
        alert("S·∫£n ph·∫©m n√†y ƒë√£ ƒë∆∞·ª£c ƒëƒÉng b√°n l·∫°i tr∆∞·ªõc ƒë√≥!");
        return; // Tho√°t h√†m.
      }
      const resellId = `resell-${Date.now()}`; // T·∫°o ID m·ªõi d·ª±a tr√™n th·ªùi gian hi·ªán t·∫°i.
      resellList.push({ id: resellId, name, img, desc, price: formattedPrice, manufacturer: manufacturer || '', isResell: true }); // Th√™m s·∫£n ph·∫©m m·ªõi v√†o resellList.
      localStorage.setItem("resellList", JSON.stringify(resellList)); // L∆∞u resellList.
      
      tempCart = tempCart.filter(item => item.name !== name); // X√≥a s·∫£n ph·∫©m t·ª´ tempCart n·∫øu tr√πng t√™n.
      localStorage.setItem("tempCartForResell", JSON.stringify(tempCart.length > 0 ? tempCart : [])); // L∆∞u tempCart m·ªõi.
      if (tempCart.length === 0) {
        localStorage.removeItem("tempCartForResell"); // X√≥a key n·∫øu
      }
      
      alert("ƒêƒÉng b√°n th√†nh c√¥ng!");  // Th√¥ng b√°o th√†nh c√¥ng sau khi ƒëƒÉng b√°n.
      resellForm.reset();  // Reset form ƒë·ªÉ x√≥a t·∫•t c·∫£ gi√° tr·ªã nh·∫≠p.
      productSelect.value = "";  // ƒê·∫∑t gi√° tr·ªã dropdown v·ªÅ m·∫∑c ƒë·ªãnh (kh√¥ng ch·ªçn).
      if (tempCart.length === 0) {  // Ki·ªÉm tra n·∫øu gi·ªè h√†ng t·∫°m th·ªùi r·ªóng.
        setTimeout(() => { window.location.href = "products.html"; }, 1500);  // Ch·ªù 1.5 gi√¢y r·ªìi chuy·ªÉn h∆∞·ªõng v·ªÅ trang products.
      } else {  // N·∫øu c√≤n s·∫£n ph·∫©m trong gi·ªè h√†ng.
        alert("Ti·∫øp t·ª•c ƒëƒÉng b√°n s·∫£n ph·∫©m c√≤n l·∫°i.");  // Th√¥ng b√°o ƒë·ªÉ ti·∫øp t·ª•c.
        loadDropdown();  // T·∫£i l·∫°i dropdown ƒë·ªÉ hi·ªÉn th·ªã s·∫£n ph·∫©m c√≤n l·∫°i.
      }
    }
  });
  if (isEditMode) {
    loadDropdown();  // N·∫øu l√† ch·∫ø ƒë·ªô ch·ªânh s·ª≠a, t·∫£i dropdown.
  }
});  // K·∫øt th√∫c s·ª± ki·ªán DOMContentLoaded, ƒë√≥ng to√†n b·ªô script.
</script>
</body>
</html>